<?xml version="1.0" encoding="UTF-8"?>

<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIcon?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.SplitPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<AnchorPane style="-fx-background-color: #ECEFF1;" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.frontend.controller.transaction.PurchaseBillController">
    <SplitPane dividerPositions="0.6" AnchorPane.topAnchor="0" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0">

    <!-- LEFT SIDE: Bill Entry Form (60%) -->
    <VBox spacing="10" style="-fx-background-color: #ECEFF1; -fx-padding: 12;">

        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" style="-fx-background-color: linear-gradient(to right, #7B1FA2, #6A1B9A); -fx-background-radius: 6; -fx-padding: 10;">
            <FontAwesomeIcon fill="white" glyphName="SHOPPING_CART" size="1.5em" />
            <Label style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;" text="PURCHASE BILL ENTRY" />
            <Region HBox.hgrow="ALWAYS" />
            <Button fx:id="btnBack" style="-fx-background-color: rgba(255,255,255,0.2); -fx-text-fill: white; -fx-font-size: 11px; -fx-background-radius: 4; -fx-cursor: hand; -fx-padding: 5 12;" text="BACK">
                <graphic>
                    <FontAwesomeIcon fill="white" glyphName="ARROW_LEFT" size="1em" />
                </graphic>
            </Button>
        </HBox>

        <!-- Section 1: Supplier & Bill Info -->
        <HBox alignment="CENTER_LEFT" spacing="12" style="-fx-background-color: white; -fx-background-radius: 6; -fx-padding: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 4, 0, 0, 1);">
            <VBox spacing="3" HBox.hgrow="ALWAYS">
                <Label fx:id="lblSupplier" style="-fx-text-fill: #7B1FA2; -fx-font-weight: bold;" text="purvzadar">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtSupplier" prefHeight="38" promptText="purvzadar Xaaoqa..." style="-fx-font-size: 14px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;">
                    <font><Font name="Kiran" size="20.0" /></font>
                </TextField>
            </VBox>
            <VBox spacing="3">
                <Label style="-fx-text-fill: #616161; -fx-font-size: 12px;" text="Bill Date" />
                <DatePicker fx:id="dpBillDate" prefHeight="38" prefWidth="130" style="-fx-font-size: 12px;" />
            </VBox>
            <VBox spacing="3">
                <Label style="-fx-text-fill: #616161; -fx-font-size: 12px;" text="Supplier Bill No." />
                <TextField fx:id="txtSupplierBillNo" prefHeight="38" prefWidth="110" promptText="Bill No." style="-fx-font-size: 13px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
            </VBox>
            <VBox spacing="3">
                <Label style="-fx-text-fill: #616161; -fx-font-size: 12px;" text="Ref No." />
                <TextField fx:id="txtReffNo" prefHeight="38" prefWidth="90" promptText="Ref" style="-fx-font-size: 13px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
            </VBox>
            <VBox alignment="CENTER" spacing="2" style="-fx-background-color: #7B1FA2; -fx-background-radius: 4; -fx-padding: 6 12;">
                <Label style="-fx-text-fill: rgba(255,255,255,0.7); -fx-font-size: 9px;" text="ITEMS" />
                <Label fx:id="lblItemCount" style="-fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold;" text="0" />
            </VBox>
        </HBox>

        <!-- Section 2: Item Entry Row -->
        <HBox alignment="CENTER_LEFT" spacing="8" style="-fx-background-color: white; -fx-background-radius: 6; -fx-padding: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 4, 0, 0, 1);">
            <VBox spacing="3">
                <Label fx:id="lblCategory" style="-fx-text-fill: #7B1FA2; -fx-font-weight: bold;" text="k^TogaorI">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtCategory" prefHeight="38" prefWidth="160" promptText="k^TogaorI Xaaoqa..." style="-fx-font-size: 14px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;">
                    <font><Font name="Kiran" size="20.0" /></font>
                </TextField>
            </VBox>
            <VBox spacing="3" HBox.hgrow="ALWAYS">
                <Label fx:id="lblItemName" style="-fx-text-fill: #7B1FA2; -fx-font-weight: bold;" text="AayTma naava">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtItemName" prefHeight="38" promptText="AayTma Xaaoqa..." style="-fx-font-size: 14px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" HBox.hgrow="ALWAYS">
                    <font><Font name="Kiran" size="20.0" /></font>
                </TextField>
            </VBox>
            <VBox spacing="3">
                <Label fx:id="lblQty" style="-fx-text-fill: #616161;" text="p`maaNa">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtQty" alignment="CENTER" prefHeight="38" prefWidth="70" promptText="0" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
            </VBox>
            <VBox spacing="3">
                <Label fx:id="lblRate" style="-fx-text-fill: #616161;" text="dr">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtRate" alignment="CENTER" prefHeight="38" prefWidth="80" promptText="0.00" style="-fx-font-size: 14px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
            </VBox>
            <VBox spacing="3">
                <Label fx:id="lblAmount" style="-fx-text-fill: #616161;" text="rk\kma">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtAmount" alignment="CENTER" editable="false" prefHeight="38" prefWidth="90" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-background-color: #E8F5E9; -fx-border-color: #4CAF50; -fx-border-radius: 4; -fx-background-radius: 4;" text="0.00" />
            </VBox>

            <!-- Action Buttons -->
            <VBox alignment="BOTTOM_CENTER" spacing="3">
                <Label text=" " style="-fx-font-size: 10px;" />
                <HBox spacing="4">
                    <Button fx:id="btnAddItem" prefHeight="38" prefWidth="65" style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-size: 10px; -fx-font-weight: bold; -fx-background-radius: 4; -fx-cursor: hand;" text="ADD">
                        <graphic><FontAwesomeIcon fill="white" glyphName="PLUS" size="0.9em" /></graphic>
                    </Button>
                    <Button fx:id="btnEditItem" prefHeight="38" prefWidth="65" style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-size: 10px; -fx-background-radius: 4; -fx-cursor: hand;" text="EDIT">
                        <graphic><FontAwesomeIcon fill="white" glyphName="PENCIL" size="0.9em" /></graphic>
                    </Button>
                    <Button fx:id="btnClearFields" prefHeight="38" prefWidth="65" style="-fx-background-color: #FF9800; -fx-text-fill: white; -fx-font-size: 10px; -fx-background-radius: 4; -fx-cursor: hand;" text="CLEAR">
                        <graphic><FontAwesomeIcon fill="white" glyphName="ERASER" size="0.9em" /></graphic>
                    </Button>
                    <Button fx:id="btnRemoveItem" prefHeight="38" prefWidth="75" style="-fx-background-color: #F44336; -fx-text-fill: white; -fx-font-size: 10px; -fx-background-radius: 4; -fx-cursor: hand;" text="REMOVE">
                        <graphic><FontAwesomeIcon fill="white" glyphName="TRASH" size="0.9em" /></graphic>
                    </Button>
                </HBox>
            </VBox>
        </HBox>

        <!-- Items Table -->
        <TableView fx:id="tblPurchaseItems" style="-fx-background-color: white; -fx-background-radius: 6;" VBox.vgrow="ALWAYS">
            <columns>
                <TableColumn fx:id="colSrNo" prefWidth="45" style="-fx-alignment: CENTER;" text="Sr." />
                <TableColumn fx:id="colItemName" prefWidth="300" text="AayTma naava" />
                <TableColumn fx:id="colQty" prefWidth="70" style="-fx-alignment: CENTER-RIGHT;" text="p`maaNa" />
                <TableColumn fx:id="colRate" prefWidth="90" style="-fx-alignment: CENTER-RIGHT;" text="dr" />
                <TableColumn fx:id="colAmount" prefWidth="100" style="-fx-alignment: CENTER-RIGHT;" text="rk\kma" />
            </columns>
        </TableView>

        <!-- Section 3: Bill Summary -->
        <HBox spacing="12" style="-fx-background-color: white; -fx-background-radius: 6; -fx-padding: 12; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 4, 0, 0, 1);">

            <!-- Left: Remarks -->
            <VBox spacing="4" prefWidth="280">
                <Label fx:id="lblRemarks" style="-fx-text-fill: #616161;" text="Xaora (Remarks)">
                    <font><Font name="Kiran" size="25.0" /></font>
                </Label>
                <TextField fx:id="txtRemarks" prefHeight="38" promptText="Xaora ilaha..." style="-fx-font-size: 14px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;">
                    <font><Font name="Kiran" size="20.0" /></font>
                </TextField>
                <HBox spacing="8" alignment="CENTER_LEFT" style="-fx-padding: 4 0 0 0;">
                    <HBox alignment="CENTER" spacing="6" style="-fx-background-color: white; -fx-border-color: #7B1FA2; -fx-border-radius: 4; -fx-background-radius: 4; -fx-padding: 2 6;">
                        <FontAwesomeIcon fill="#7B1FA2" glyphName="MONEY" size="1em" />
                        <ComboBox fx:id="cmbPaymentMode" prefHeight="28" prefWidth="150" style="-fx-font-size: 20px; -fx-background-color: transparent; -fx-border-color: transparent;" />
                    </HBox>
                </HBox>
            </VBox>

            <Separator orientation="VERTICAL" />

            <!-- Center: Bill Calculations -->
            <VBox spacing="6" style="-fx-padding: 0 8;" HBox.hgrow="ALWAYS">
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label fx:id="lblSubTotalLabel" prefWidth="130" style="-fx-text-fill: #616161;" text="ekUNa rk\kma">
                        <font><Font name="Kiran" size="25.0" /></font>
                    </Label>
                    <Label fx:id="lblSubTotal" prefWidth="100" style="-fx-text-fill: #212121; -fx-font-size: 16px; -fx-font-weight: bold; -fx-alignment: CENTER-RIGHT;" text="0.00" />
                </HBox>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label fx:id="lblDiscountLabel" prefWidth="130" style="-fx-text-fill: #616161;" text="sUT (-)">
                        <font><Font name="Kiran" size="25.0" /></font>
                    </Label>
                    <TextField fx:id="txtDiscount" alignment="CENTER_RIGHT" prefHeight="30" prefWidth="100" promptText="0.00" style="-fx-font-size: 13px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
                </HBox>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label prefWidth="110" style="-fx-text-fill: #616161; -fx-font-size: 13px;" text="GST (+)" />
                    <TextField fx:id="txtGst" alignment="CENTER_RIGHT" prefHeight="30" prefWidth="100" promptText="0.00" style="-fx-font-size: 13px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
                </HBox>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label prefWidth="110" style="-fx-text-fill: #616161; -fx-font-size: 13px;" text="Other Tax (+)" />
                    <TextField fx:id="txtOtherTax" alignment="CENTER_RIGHT" prefHeight="30" prefWidth="100" promptText="0.00" style="-fx-font-size: 13px; -fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" />
                </HBox>
            </VBox>

            <Separator orientation="VERTICAL" />

            <!-- Right: Grand Total & Actions -->
            <VBox alignment="CENTER" spacing="6">
                <VBox alignment="CENTER" style="-fx-background-color: linear-gradient(to bottom, #7B1FA2, #6A1B9A); -fx-background-radius: 6; -fx-padding: 12 20;">
                    <Label fx:id="lblGrandTotalLabel" style="-fx-text-fill: rgba(255,255,255,0.8); -fx-font-size: 14px;" text="ema\D TaoTla">
                        <font><Font name="Kiran" size="25.0" /></font>
                    </Label>
                    <Label fx:id="lblGrandTotal" style="-fx-text-fill: white; -fx-font-size: 26px; -fx-font-weight: bold;" text="0.00" />
                </VBox>
                <HBox alignment="CENTER" spacing="6">
                    <Button fx:id="btnSaveBill" prefHeight="36" prefWidth="90" style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-size: 12px; -fx-font-weight: bold; -fx-background-radius: 4; -fx-cursor: hand;" text="SAVE">
                        <graphic><FontAwesomeIcon fill="white" glyphName="SAVE" size="1em" /></graphic>
                    </Button>
                    <Button fx:id="btnNewBill" prefHeight="36" prefWidth="80" style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-size: 11px; -fx-background-radius: 4; -fx-cursor: hand;" text="NEW">
                        <graphic><FontAwesomeIcon fill="white" glyphName="PLUS" size="1em" /></graphic>
                    </Button>
                    <Button fx:id="btnClearAll" prefHeight="36" prefWidth="80" style="-fx-background-color: #FF5722; -fx-text-fill: white; -fx-font-size: 11px; -fx-background-radius: 4; -fx-cursor: hand;" text="CLEAR">
                        <graphic><FontAwesomeIcon fill="white" glyphName="TRASH" size="1em" /></graphic>
                    </Button>
                </HBox>
            </VBox>
        </HBox>
    </VBox>

    <!-- RIGHT SIDE: Existing Bills Panel (40%) -->
    <VBox spacing="0" style="-fx-background-color: #FFFFFF; -fx-border-color: #E0E0E0; -fx-border-width: 0 0 0 1;">

        <!-- Panel Header -->
        <HBox alignment="CENTER_LEFT" spacing="8" style="-fx-background-color: linear-gradient(to right, #7B1FA2, #9C27B0); -fx-padding: 10 12;">
            <FontAwesomeIcon fill="white" glyphName="LIST_ALT" size="1.2em" />
            <Label style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: white;" text="PURCHASE BILLS" />
            <Region HBox.hgrow="ALWAYS" />
            <Button fx:id="btnRefreshBills" style="-fx-background-color: rgba(255,255,255,0.2); -fx-text-fill: white; -fx-font-size: 10px; -fx-background-radius: 12; -fx-cursor: hand; -fx-padding: 4 10;">
                <graphic>
                    <FontAwesomeIcon fill="white" glyphName="REFRESH" size="0.9em" />
                </graphic>
            </Button>
        </HBox>

        <!-- Search Filters Section -->
        <VBox spacing="8" style="-fx-background-color: #FAFAFA; -fx-padding: 10; -fx-border-color: #E0E0E0; -fx-border-width: 0 0 1 0;">

            <!-- Row 1: Date Range -->
            <HBox alignment="CENTER_LEFT" spacing="6">
                <FontAwesomeIcon fill="#7B1FA2" glyphName="CALENDAR" size="1em" />
                <DatePicker fx:id="dpSearchFromDate" prefHeight="30" prefWidth="130" promptText="From Date" style="-fx-font-size: 10px; -fx-background-radius: 4;" />
                <Label style="-fx-text-fill: #757575; -fx-font-size: 10px;" text="to" />
                <DatePicker fx:id="dpSearchToDate" prefHeight="30" prefWidth="130" promptText="To Date" style="-fx-font-size: 10px; -fx-background-radius: 4;" />
            </HBox>

            <!-- Row 2: Bill No Search -->
            <HBox alignment="CENTER_LEFT" spacing="6">
                <FontAwesomeIcon fill="#7B1FA2" glyphName="FILE_TEXT_ALT" size="1em" />
                <TextField fx:id="txtSearchBillNo" prefHeight="30" promptText="Bill Number" style="-fx-font-size: 11px; -fx-background-color: white; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" HBox.hgrow="ALWAYS" />
            </HBox>

            <!-- Row 3: Supplier Search -->
            <HBox alignment="CENTER_LEFT" spacing="6">
                <FontAwesomeIcon fill="#7B1FA2" glyphName="TRUCK" size="1em" />
                <TextField fx:id="txtSearchSupplier" prefHeight="30" promptText="Supplier Name" style="-fx-font-size: 11px; -fx-background-color: white; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-background-radius: 4;" HBox.hgrow="ALWAYS">
                    <font><Font name="Kiran" size="14.0" /></font>
                </TextField>
            </HBox>

            <!-- Action Buttons -->
            <HBox alignment="CENTER" spacing="6">
                <Button fx:id="btnSearchBills" prefHeight="28" style="-fx-background-color: #7B1FA2; -fx-text-fill: white; -fx-font-size: 10px; -fx-font-weight: bold; -fx-background-radius: 4; -fx-cursor: hand; -fx-padding: 5 14;" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                    <graphic>
                        <FontAwesomeIcon fill="white" glyphName="SEARCH" size="0.9em" />
                    </graphic>
                    <text>Search</text>
                </Button>
                <Button fx:id="btnClearSearch" prefHeight="28" style="-fx-background-color: #9E9E9E; -fx-text-fill: white; -fx-font-size: 10px; -fx-background-radius: 4; -fx-cursor: hand; -fx-padding: 5 10;">
                    <graphic>
                        <FontAwesomeIcon fill="white" glyphName="TIMES" size="0.9em" />
                    </graphic>
                </Button>
            </HBox>
        </VBox>

        <!-- Existing Bills Table -->
        <TableView fx:id="tblExistingBills" fixedCellSize="28" style="-fx-font-size: 11px; -fx-background-color: white;" VBox.vgrow="ALWAYS">
            <columns>
                <TableColumn fx:id="colBillNo" minWidth="50" prefWidth="55" text="Bill#" />
                <TableColumn fx:id="colBillDate" minWidth="75" prefWidth="80" text="Date" />
                <TableColumn fx:id="colSupplierName" minWidth="100" prefWidth="110" text="Supplier" />
                <TableColumn fx:id="colBillAmount" minWidth="70" prefWidth="75" text="Amount" />
                <TableColumn fx:id="colBillStatus" minWidth="55" prefWidth="60" text="Status" />
            </columns>
            <columnResizePolicy>
                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
            </columnResizePolicy>
        </TableView>

        <!-- Summary Footer -->
        <VBox spacing="0" style="-fx-background-color: linear-gradient(to bottom, #F5F5F5, #EEEEEE); -fx-padding: 0; -fx-border-color: #E0E0E0; -fx-border-width: 1 0 0 0;">
            <HBox alignment="CENTER" spacing="0">
                <!-- Pending -->
                <VBox alignment="CENTER" spacing="2" style="-fx-padding: 8 12; -fx-border-color: #E0E0E0; -fx-border-width: 0 1 0 0;" HBox.hgrow="ALWAYS">
                    <Label style="-fx-font-size: 9px; -fx-text-fill: #9E9E9E;" text="PENDING" />
                    <Label fx:id="lblTotalPending" style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: #FF9800;" text="₹0" />
                </VBox>
                <!-- Paid -->
                <VBox alignment="CENTER" spacing="2" style="-fx-padding: 8 12; -fx-border-color: #E0E0E0; -fx-border-width: 0 1 0 0;" HBox.hgrow="ALWAYS">
                    <Label style="-fx-font-size: 9px; -fx-text-fill: #9E9E9E;" text="PAID" />
                    <Label fx:id="lblTotalPaid" style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: #4CAF50;" text="₹0" />
                </VBox>
                <!-- Total -->
                <VBox alignment="CENTER" spacing="2" style="-fx-background-color: #7B1FA2; -fx-padding: 8 12;" HBox.hgrow="ALWAYS">
                    <Label style="-fx-font-size: 9px; -fx-text-fill: rgba(255,255,255,0.7);" text="TOTAL" />
                    <Label fx:id="lblTotalAmount" style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: white;" text="₹0" />
                </VBox>
            </HBox>
        </VBox>
    </VBox>
    </SplitPane>
</AnchorPane>
